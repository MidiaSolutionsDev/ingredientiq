<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Champagne Score Demo</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #f9fafb;
      color: #111;
      margin: 0;
      padding: 2rem;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 700px;
      width: 100%;
      background: #fff;
      padding: 2rem;
      border-radius: 1rem;
      box-shadow: 0 6px 20px rgba(0,0,0,0.08);
    }
    h1 {
      font-family: "Playfair Display", serif;
      font-size: 1.8rem;
      margin-bottom: 1rem;
      color: #242426;
    }
    textarea {
      width: 100%;
      padding: 0.75rem;
      border-radius: 0.5rem;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      resize: vertical;
      margin-bottom: 1rem;
    }
    button {
      background: #242426;
      color: #fff;
      border: none;
      padding: 0.75rem 1.25rem;
      border-radius: 0.5rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s;
    }
    button:hover {
      background: #111;
    }
    .result {
      margin-top: 1.5rem;
    }
    .score {
      font-size: 1.5rem;
      font-weight: bold;
      margin-bottom: 1rem;
    }
    .score.good { color: #10b981; }
    .score.warning { color: #f59e0b; }
    .score.bad { color: #ef4444; }
    ul {
      list-style: none;
      padding: 0;
    }
    li {
      margin: 0.25rem 0;
      padding: 0.5rem 0.75rem;
      border-radius: 0.4rem;
    }
    .green { background: #ecfdf5; color: #065f46; }
    .yellow { background: #fffbeb; color: #824d00; }
    .red { background: #fef2f2; color: #7f1d1d; }
    .unknown { background: #f3f4f6; color: #374151; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ingredient Analyzer</h1>

    <textarea id="ingredients" rows="4"
      placeholder="Paste ingredients here, e.g. Aqua (Water), Glycerin, Phenoxyethanol, Fragrance..."></textarea>

    <button onclick="run()">Analyze</button>

    <div id="out" class="result">Paste an ingredient list and click Analyze</div>
  </div>

  <script>
    function renderResult(data) {
      const out = document.querySelector("#out");

      if (data.error) {
        out.innerHTML = `<p>❌ Error: ${data.error.message}</p>`;
        return;
      }

      // Score color class
      let scoreClass = "good";
      if (data.score.value < 50) scoreClass = "bad";
      else if (data.score.value < 80) scoreClass = "warning";

      let html = `
        <div class="score ${scoreClass}">Champagne Score: ${data.score.value}/100</div>
      `;

      const buckets = ["green", "yellow", "red", "unknown"];
      buckets.forEach(bucket => {
        if (data.buckets[bucket].length > 0) {
          html += `<h3>${bucket.charAt(0).toUpperCase() + bucket.slice(1)}</h3><ul>`;
          data.buckets[bucket].forEach(item => {
            html += `<li class="${bucket}"><strong>${item.inci}</strong> — ${item.why || "No info"}</li>`;
          });
          html += `</ul>`;
        }
      });

      out.innerHTML = html;
    }

    async function run() {
      const text = document.querySelector("#ingredients").value.trim();
      const out = document.querySelector("#out");

      if (!text) {
        out.textContent = "⚠️ Please paste some ingredients first.";
        return;
      }

      out.textContent = "⏳ Analyzing...";

      try {
        const r = await fetch("http://localhost:3000/api/v1/analyze", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ input: { mode: "text", text } })
        });
        const json = await r.json();
        renderResult(json);
      } catch (e) {
        out.textContent = "❌ Error calling API: " + e.message;
      }
    }
  </script>
</body>
</html>
